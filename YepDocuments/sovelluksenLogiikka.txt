üîê Vaihe 1: K√§ytt√§j√§ tunnistautuu (Login)
Tilanne:
K√§ytt√§j√§ kirjautuu sis√§√§n ReactVite-sovelluksesta lomakkeella, johon h√§n sy√∂tt√§√§ k√§ytt√§j√§tunnuksen ja salasanan.

1. Frontend (React):
K√§ytt√§j√§ painaa Login-nappia ‚Üí lomake l√§hett√§√§ POST-pyynn√∂n osoitteeseen:

POST /api/token/
Pyynt√∂ sis√§lt√§√§:


{
  "username": "teppo",
  "password": "testaaja"
}
2. Backend (DRF SimpleJWT):
Reitti /api/token/ on m√§√§ritelty (P√§√§sovelluksen eli easylist urls.py-tiedostossa), yleens√§ n√§in:

from rest_framework_simplejwt.views import TokenObtainPairView

urlpatterns = [
    path('api/token/', TokenObtainPairView.as_view(), name='token_obtain_pair'),
]
T√§m√§ TokenObtainPairView:
-tarkistaa k√§ytt√§j√§tunnuksen ja salasanan Tietokannasta
-palauttaa access tokenin ja refresh tokenin, jos tunnistautuminen onnistuu

Esimerkki vastauksesta:

{
  "access": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1...",
  "refresh": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1..."
}
T√§ss√§ vaiheessa backend on vain todentanut k√§ytt√§j√§n SimpleJWT:n avulla ja palauttanut tokenit. Mit√§√§n muuta ei ole viel√§ haettu (esim. tuotteita).

üîÅ VAIHE 2 (uudelleen): "GET /api/products/"
1. üîó K√§ytt√§j√§ l√§hett√§√§ pyynn√∂n
K√§ytt√§j√§ on kirjautunut ‚Üí React l√§hett√§√§:

GET http://localhost:8000/api/products/
Authorization: Bearer <access-token>
2. üåê easylist/urls.py
T√§m√§ tiedosto on p√§√§reititt√§j√§ koko projektissa.


path('api/products/', include('products.urls')),
T√§m√§ tarkoittaa:
‚û° kaikki osoitteet, jotka alkavat /api/products/, ohjataan products-sovelluksen urls.py-tiedostoon.

3. üåê products/urls.py

router = DefaultRouter()
router.register(r'', ProductViewSet, basename='product')

urlpatterns = [
    path('', include(router.urls)),
]
T√§m√§ tarkoittaa:

r'' tarkoittaa, ett√§ GET /api/products/ ‚Üí ohjataan suoraan ProductViewSetiin

Router luo automaattisesti seuraavat reitit:

GET /api/products/ ‚Üí list()-toiminto

GET /api/products/{id}/ ‚Üí retrieve()-toiminto

jne.

4. üëÄ products/views.py

class ProductViewSet(ModelViewSet):
    serializer_class = ProductSerializer
    permission_classes = [IsAuthenticated]

    def get_queryset(self):
        queryset = Product.objects.all()
        productname = self.request.query_params.get('productname')
        if productname is not None:
            queryset = queryset.filter(product_name=productname)
        return queryset
T√§ss√§:

Koska k√§ytet√§√§n ModelViewSet, niin GET /api/products/ automaattisesti kutsuu list()-metodia, joka k√§ytt√§√§ get_queryset()-metodia

get_queryset() palauttaa kaikki tuotteet

Jos productname on annettu osoiterivill√§ query-parametrina, tehd√§√§n suodatus

T√§rke√§:

permission_classes = [IsAuthenticated] ‚Üí jos k√§ytt√§j√§ll√§ ei ole access-tokenia ‚Üí 401 Unauthorized

5. üß† products/models.py
class Product(models.Model):
    product_id = models.AutoField(primary_key=True)
    product_name = models.CharField(max_length=40)
    image_link = models.CharField(max_length=200, blank=True, null=True)
    category = models.ForeignKey(Category, on_delete=models.CASCADE, related_name='products')
T√§m√§ on se tietokantamalli, jota haetaan. ViewSetiss√§ Product.objects.all() k√§ytt√§√§ t√§t√§ mallia.

6. üîÑ products/serializers.py

class ProductSerializer(serializers.ModelSerializer):
    class Meta:
        model = Product
        fields = '__all__'
T√§m√§ muuntaa Product-olion JSON-muotoon, jonka DRF l√§hett√§√§ vastauksena frontendille.

‚úÖ Lopputulos:
Kun k√§ytt√§j√§ tekee GET /api/products/ access-tokenin kanssa:

Pyynt√∂ saapuu easylist/urls.py

Siirtyy products/urls.py kautta routerille

Router tunnistaa: tyhj√§ reitti '' ‚Üí ProductViewSet

DRF kutsuu get_queryset(), joka palauttaa Product.objects.all()

Serializer muuntaa tuotteet JSONiksi ‚Üí vastauksena frontendille